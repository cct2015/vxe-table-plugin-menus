"use strict";

exports.__esModule = true;

var xe_utils_1 = require("xe-utils/methods/xe-utils");

var menuMap = {
  CLEAR_CELL: function CLEAR_CELL(_a) {
    var $table = _a.$table,
        row = _a.row,
        column = _a.column;

    if (row && column) {
      $table.clearData(row, column.property);
    }
  },
  CLEAR_ROW: function CLEAR_ROW(_a) {
    var $table = _a.$table,
        row = _a.row;

    if (row) {
      $table.clearData(row);
    }
  },
  CLEAR_SELECTION_ROW: function CLEAR_SELECTION_ROW(_a) {
    var $table = _a.$table;
    $table.clearData($table.getSelectRecords());
  },
  CLEAR_ALL: function CLEAR_ALL(_a) {
    var $table = _a.$table;
    $table.clearData();
  },
  REVERT_CELL: function REVERT_CELL(_a) {
    var $table = _a.$table,
        row = _a.row,
        column = _a.column;

    if (row && column) {
      $table.revertData(row, column.property);
    }
  },
  REVERT_ROW: function REVERT_ROW(_a) {
    var $table = _a.$table,
        row = _a.row;

    if (row) {
      $table.revertData(row);
    }
  },
  REVERT_SELECTION_ROW: function REVERT_SELECTION_ROW(_a) {
    var $table = _a.$table;
    $table.revertData($table.getSelectRecords());
  },
  REVERT_ALL: function REVERT_ALL(_a) {
    var $table = _a.$table;
    $table.revertData();
  },
  INSERT_ROW: function INSERT_ROW(_a) {
    var $table = _a.$table,
        menu = _a.menu;
    $table.insert(menu.params);
  },
  INSERT_ACTIVED_ROW: function INSERT_ACTIVED_ROW(_a) {
    var $table = _a.$table,
        menu = _a.menu,
        column = _a.column;
    var args = menu.params || [];
    $table.insert(args[0]).then(function (_a) {
      var row = _a.row;
      return $table.setActiveCell(row, args[1] || column.property);
    });
  },
  INSERT_AT_ROW: function INSERT_AT_ROW(_a) {
    var $table = _a.$table,
        menu = _a.menu,
        row = _a.row;

    if (row) {
      $table.insertAt(menu.params, row);
    }
  },
  INSERT_AT_ACTIVED_ROW: function INSERT_AT_ACTIVED_ROW(_a) {
    var $table = _a.$table,
        menu = _a.menu,
        row = _a.row,
        column = _a.column;

    if (row) {
      var args_1 = menu.params || [];
      $table.insertAt(args_1[0], row).then(function (_a) {
        var row = _a.row;
        return $table.setActiveCell(row, args_1[1] || column.property);
      });
    }
  },
  DELETE_ROW: function DELETE_ROW(_a) {
    var $table = _a.$table,
        row = _a.row;

    if (row) {
      $table.remove(row);
    }
  },
  DELETE_SELECTION_ROW: function DELETE_SELECTION_ROW(_a) {
    var $table = _a.$table;
    $table.removeSelecteds();
  },
  DELETE_ALL: function DELETE_ALL(_a) {
    var $table = _a.$table;
    $table.remove();
  },
  CLEAR_SORT: function CLEAR_SORT(_a) {
    var $table = _a.$table;
    $table.clearSort();
  },
  SORT_ASC: function SORT_ASC(_a, evnt) {
    var $table = _a.$table,
        column = _a.column;

    if (column) {
      $table.triggerSortEvent(evnt, column, 'asc');
    }
  },
  SORT_DESC: function SORT_DESC(_a, evnt) {
    var $table = _a.$table,
        column = _a.column;

    if (column) {
      $table.triggerSortEvent(evnt, column, 'desc');
    }
  },
  CLEAR_FILTER: function CLEAR_FILTER(_a) {
    var $table = _a.$table,
        column = _a.column;

    if (column) {
      $table.clearFilter(column.property);
    }
  },
  CLEAR_ALL_FILTER: function CLEAR_ALL_FILTER(_a) {
    var $table = _a.$table;
    $table.clearFilter();
  },
  FILTER_CELL: function FILTER_CELL(_a) {
    var $table = _a.$table,
        row = _a.row,
        column = _a.column;

    if (row && column) {
      var property_1 = column.property;
      $table.filter(property_1).then(function (options) {
        if (options.length) {
          var option = options[0];
          option.data = xe_utils_1["default"].get(row, property_1);
          option.checked = true;
        }
      }).then(function () {
        return $table.updateData();
      });
    }
  },
  EXPORT_ROW: function EXPORT_ROW(_a) {
    var $table = _a.$table,
        menu = _a.menu,
        row = _a.row;

    if (row) {
      var opts = {
        data: [row]
      };
      $table.exportCsv(menu.params ? xe_utils_1["default"].assign(opts, menu.params[0]) : opts);
    }
  },
  EXPORT_SELECTION_ROW: function EXPORT_SELECTION_ROW(_a) {
    var $table = _a.$table,
        menu = _a.menu;
    var opts = {
      data: $table.getSelectRecords()
    };
    $table.exportCsv(menu.params ? xe_utils_1["default"].assign(opts, menu.params[0]) : opts);
  },
  EXPORT_ALL: function EXPORT_ALL(_a) {
    var $table = _a.$table;
    $table.exportCsv();
  },
  HIDDEN_COLUMN: function HIDDEN_COLUMN(_a) {
    var $table = _a.$table,
        column = _a.column;

    if (column) {
      $table.hideColumn();
    }
  },
  RESET_COLUMN: function RESET_COLUMN(_a) {
    var $table = _a.$table;
    $table.resetCustoms();
  },
  RESET_RESIZABLE: function RESET_RESIZABLE(_a) {
    var $table = _a.$table;
    $table.resetResizable();
  },
  RESET_ALL: function RESET_ALL(_a) {
    var $table = _a.$table;
    $table.resetAll();
  }
};

function checkPrivilege(item, params) {
  var code = item.code;
  var columns = params.columns,
      column = params.column;

  switch (code) {
    case 'CLEAR_SORT':
      item.disabled = !columns.some(function (column) {
        return column.sortable && column.order;
      });
      break;

    case 'CLEAR_ALL_FILTER':
      item.disabled = !columns.some(function (column) {
        return column.filters && column.filters.some(function (option) {
          return option.checked;
        });
      });
      break;

    case 'CLEAR_CELL':
    case 'CLEAR_ROW':
    case 'REVERT_CELL':
    case 'REVERT_ROW':
    case 'INSERT_AT_ROW':
    case 'INSERT_AT_ACTIVED_ROW':
    case 'DELETE_ROW':
    case 'SORT_ASC':
    case 'SORT_DESC':
    case 'CLEAR_FILTER':
    case 'FILTER_CELL':
    case 'EXPORT_ROW':
    case 'HIDDEN_COLUMN':
      item.disabled = !column;

      if (!item.disabled) {
        switch (code) {
          case 'SORT_ASC':
          case 'SORT_DESC':
            item.disabled = !column.sortable;
            break;

          case 'FILTER_CELL':
          case 'CLEAR_FILTER':
            item.disabled = !column.filters || !column.filters.length;

            if (!item.disabled) {
              switch (code) {
                case 'CLEAR_FILTER':
                  item.disabled = !column.filters.some(function (option) {
                    return option.checked;
                  });
                  break;
              }
            }

            break;
        }
      }

      break;
  }
}

function handlePrivilegeEvent(params) {
  params.options.forEach(function (list) {
    list.forEach(function (item) {
      checkPrivilege(item, params);

      if (item.children) {
        item.children.forEach(function (child) {
          checkPrivilege(child, params);
        });
      }
    });
  });
}
/**
 * 基于 vxe-table 表格的增强插件，提供实用的快捷菜单集
 */


exports.VXETablePluginMenus = {
  install: function install(xtable) {
    xtable.interceptor.add('event.show_menu', handlePrivilegeEvent);
    xtable.menus.mixin(menuMap);
  }
};

if (typeof window !== 'undefined' && window.VXETable) {
  window.VXETable.use(exports.VXETablePluginMenus);
}

exports["default"] = exports.VXETablePluginMenus;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIiwiaW5kZXgudHMiXSwibmFtZXMiOlsiZXhwb3J0cyIsIl9fZXNNb2R1bGUiLCJ4ZV91dGlsc18xIiwicmVxdWlyZSIsIm1lbnVNYXAiLCJDTEVBUl9DRUxMIiwiX2EiLCIkdGFibGUiLCJyb3ciLCJjb2x1bW4iLCJjbGVhckRhdGEiLCJwcm9wZXJ0eSIsIkNMRUFSX1JPVyIsIkNMRUFSX1NFTEVDVElPTl9ST1ciLCJnZXRTZWxlY3RSZWNvcmRzIiwiQ0xFQVJfQUxMIiwiUkVWRVJUX0NFTEwiLCJyZXZlcnREYXRhIiwiUkVWRVJUX1JPVyIsIlJFVkVSVF9TRUxFQ1RJT05fUk9XIiwiUkVWRVJUX0FMTCIsIklOU0VSVF9ST1ciLCJtZW51IiwiaW5zZXJ0IiwicGFyYW1zIiwiSU5TRVJUX0FDVElWRURfUk9XIiwiYXJncyIsInRoZW4iLCJzZXRBY3RpdmVDZWxsIiwiSU5TRVJUX0FUX1JPVyIsImluc2VydEF0IiwiSU5TRVJUX0FUX0FDVElWRURfUk9XIiwiYXJnc18xIiwiREVMRVRFX1JPVyIsInJlbW92ZSIsIkRFTEVURV9TRUxFQ1RJT05fUk9XIiwicmVtb3ZlU2VsZWN0ZWRzIiwiREVMRVRFX0FMTCIsIkNMRUFSX1NPUlQiLCJjbGVhclNvcnQiLCJTT1JUX0FTQyIsImV2bnQiLCJ0cmlnZ2VyU29ydEV2ZW50IiwiU09SVF9ERVNDIiwiQ0xFQVJfRklMVEVSIiwiY2xlYXJGaWx0ZXIiLCJDTEVBUl9BTExfRklMVEVSIiwiRklMVEVSX0NFTEwiLCJwcm9wZXJ0eV8xIiwiZmlsdGVyIiwib3B0aW9ucyIsImxlbmd0aCIsIm9wdGlvbiIsImRhdGEiLCJnZXQiLCJjaGVja2VkIiwidXBkYXRlRGF0YSIsIkVYUE9SVF9ST1ciLCJvcHRzIiwiZXhwb3J0Q3N2IiwiYXNzaWduIiwiRVhQT1JUX1NFTEVDVElPTl9ST1ciLCJFWFBPUlRfQUxMIiwiSElEREVOX0NPTFVNTiIsImhpZGVDb2x1bW4iLCJSRVNFVF9DT0xVTU4iLCJyZXNldEN1c3RvbXMiLCJSRVNFVF9SRVNJWkFCTEUiLCJyZXNldFJlc2l6YWJsZSIsIlJFU0VUX0FMTCIsInJlc2V0QWxsIiwiY2hlY2tQcml2aWxlZ2UiLCJpdGVtIiwiY29kZSIsImNvbHVtbnMiLCJkaXNhYmxlZCIsInNvbWUiLCJzb3J0YWJsZSIsIm9yZGVyIiwiZmlsdGVycyIsImhhbmRsZVByaXZpbGVnZUV2ZW50IiwiZm9yRWFjaCIsImxpc3QiLCJjaGlsZHJlbiIsImNoaWxkIiwiVlhFVGFibGVQbHVnaW5NZW51cyIsImluc3RhbGwiLCJ4dGFibGUiLCJpbnRlcmNlcHRvciIsImFkZCIsIm1lbnVzIiwibWl4aW4iLCJ3aW5kb3ciLCJWWEVUYWJsZSIsInVzZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBQ0FBLE9BQU8sQ0FBQ0MsVUFBUixHQUFxQixJQUFyQjs7QUNEQSxJQUFBQyxVQUFBLEdBQUFDLE9BQUEsQ0FBQSwyQkFBQSxDQUFBOztBQUdBLElBQU1DLE9BQU8sR0FBRztBQUNkQyxFQUFBQSxVQUFVLEVBQVYsb0JBQVlDLEVBQVosRUFBd0M7QURDbEMsUUNEUUMsTUFBQSxHQUFBRCxFQUFBLENBQUFDLE1EQ1I7QUFBQSxRQ0RnQkMsR0FBQSxHQUFBRixFQUFBLENBQUFFLEdEQ2hCO0FBQUEsUUNEcUJDLE1BQUEsR0FBQUgsRUFBQSxDQUFBRyxNRENyQjs7QUNBSixRQUFJRCxHQUFHLElBQUlDLE1BQVgsRUFBbUI7QUFDakJGLE1BQUFBLE1BQU0sQ0FBQ0csU0FBUCxDQUFpQkYsR0FBakIsRUFBc0JDLE1BQU0sQ0FBQ0UsUUFBN0I7QUFDRDtBQUNGLEdBTGE7QUFNZEMsRUFBQUEsU0FBUyxFQUFULG1CQUFXTixFQUFYLEVBQStCO0FERXpCLFFDRk9DLE1BQUEsR0FBQUQsRUFBQSxDQUFBQyxNREVQO0FBQUEsUUNGZUMsR0FBQSxHQUFBRixFQUFBLENBQUFFLEdERWY7O0FDREosUUFBSUEsR0FBSixFQUFTO0FBQ1BELE1BQUFBLE1BQU0sQ0FBQ0csU0FBUCxDQUFpQkYsR0FBakI7QUFDRDtBQUNGLEdBVmE7QUFX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T2IsSUFBSSxPQUFPd0YsTUFBUCxLQUFrQixXQUFsQixJQUFpQ0EsTUFBTSxDQUFDQyxRQUE1QyxFQUFzRDtBQUNwREQsRUFBQUEsTUFBTSxDQUFDQyxRQUFQLENBQWdCQyxHQUFoQixDQUFvQjlGLE9BQUEsQ0FBQXFGLG1CQUFwQjtBQUNEOztBQUVEckYsT0FBQSxDQUFBLFNBQUEsQ0FBQSxHQUFlQSxPQUFBLENBQUFxRixtQkFBZiIsImZpbGUiOiJpbmRleC5jb21tb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcbmV4cG9ydHMuX19lc01vZHVsZSA9IHRydWU7XG52YXIgeGVfdXRpbHNfMSA9IHJlcXVpcmUoXCJ4ZS11dGlscy9tZXRob2RzL3hlLXV0aWxzXCIpO1xudmFyIG1lbnVNYXAgPSB7XG4gICAgQ0xFQVJfQ0VMTDogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBfYS4kdGFibGUsIHJvdyA9IF9hLnJvdywgY29sdW1uID0gX2EuY29sdW1uO1xuICAgICAgICBpZiAocm93ICYmIGNvbHVtbikge1xuICAgICAgICAgICAgJHRhYmxlLmNsZWFyRGF0YShyb3csIGNvbHVtbi5wcm9wZXJ0eSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIENMRUFSX1JPVzogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBfYS4kdGFibGUsIHJvdyA9IF9hLnJvdztcbiAgICAgICAgaWYgKHJvdykge1xuICAgICAgICAgICAgJHRhYmxlLmNsZWFyRGF0YShyb3cpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBDTEVBUl9TRUxFQ1RJT05fUk9XOiBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyICR0YWJsZSA9IF9hLiR0YWJsZTtcbiAgICAgICAgJHRhYmxlLmNsZWFyRGF0YSgkdGFibGUuZ2V0U2VsZWN0UmVjb3JkcygpKTtcbiAgICB9LFxuICAgIENMRUFSX0FMTDogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBfYS4kdGFibGU7XG4gICAgICAgICR0YWJsZS5jbGVhckRhdGEoKTtcbiAgICB9LFxuICAgIFJFVkVSVF9DRUxMOiBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyICR0YWJsZSA9IF9hLiR0YWJsZSwgcm93ID0gX2Eucm93LCBjb2x1bW4gPSBfYS5jb2x1bW47XG4gICAgICAgIGlmIChyb3cgJiYgY29sdW1uKSB7XG4gICAgICAgICAgICAkdGFibGUucmV2ZXJ0RGF0YShyb3csIGNvbHVtbi5wcm9wZXJ0eSk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIFJFVkVSVF9ST1c6IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICB2YXIgJHRhYmxlID0gX2EuJHRhYmxlLCByb3cgPSBfYS5yb3c7XG4gICAgICAgIGlmIChyb3cpIHtcbiAgICAgICAgICAgICR0YWJsZS5yZXZlcnREYXRhKHJvdyk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIFJFVkVSVF9TRUxFQ1RJT05fUk9XOiBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyICR0YWJsZSA9IF9hLiR0YWJsZTtcbiAgICAgICAgJHRhYmxlLnJldmVydERhdGEoJHRhYmxlLmdldFNlbGVjdFJlY29yZHMoKSk7XG4gICAgfSxcbiAgICBSRVZFUlRfQUxMOiBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyICR0YWJsZSA9IF9hLiR0YWJsZTtcbiAgICAgICAgJHRhYmxlLnJldmVydERhdGEoKTtcbiAgICB9LFxuICAgIElOU0VSVF9ST1c6IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICB2YXIgJHRhYmxlID0gX2EuJHRhYmxlLCBtZW51ID0gX2EubWVudTtcbiAgICAgICAgJHRhYmxlLmluc2VydChtZW51LnBhcmFtcyk7XG4gICAgfSxcbiAgICBJTlNFUlRfQUNUSVZFRF9ST1c6IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICB2YXIgJHRhYmxlID0gX2EuJHRhYmxlLCBtZW51ID0gX2EubWVudSwgY29sdW1uID0gX2EuY29sdW1uO1xuICAgICAgICB2YXIgYXJncyA9IG1lbnUucGFyYW1zIHx8IFtdO1xuICAgICAgICAkdGFibGUuaW5zZXJ0KGFyZ3NbMF0pXG4gICAgICAgICAgICAudGhlbihmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgICAgIHZhciByb3cgPSBfYS5yb3c7XG4gICAgICAgICAgICByZXR1cm4gJHRhYmxlLnNldEFjdGl2ZUNlbGwocm93LCBhcmdzWzFdIHx8IGNvbHVtbi5wcm9wZXJ0eSk7XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgSU5TRVJUX0FUX1JPVzogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBfYS4kdGFibGUsIG1lbnUgPSBfYS5tZW51LCByb3cgPSBfYS5yb3c7XG4gICAgICAgIGlmIChyb3cpIHtcbiAgICAgICAgICAgICR0YWJsZS5pbnNlcnRBdChtZW51LnBhcmFtcywgcm93KTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgSU5TRVJUX0FUX0FDVElWRURfUk9XOiBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyICR0YWJsZSA9IF9hLiR0YWJsZSwgbWVudSA9IF9hLm1lbnUsIHJvdyA9IF9hLnJvdywgY29sdW1uID0gX2EuY29sdW1uO1xuICAgICAgICBpZiAocm93KSB7XG4gICAgICAgICAgICB2YXIgYXJnc18xID0gbWVudS5wYXJhbXMgfHwgW107XG4gICAgICAgICAgICAkdGFibGUuaW5zZXJ0QXQoYXJnc18xWzBdLCByb3cpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJvdyA9IF9hLnJvdztcbiAgICAgICAgICAgICAgICByZXR1cm4gJHRhYmxlLnNldEFjdGl2ZUNlbGwocm93LCBhcmdzXzFbMV0gfHwgY29sdW1uLnByb3BlcnR5KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBERUxFVEVfUk9XOiBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyICR0YWJsZSA9IF9hLiR0YWJsZSwgcm93ID0gX2Eucm93O1xuICAgICAgICBpZiAocm93KSB7XG4gICAgICAgICAgICAkdGFibGUucmVtb3ZlKHJvdyk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIERFTEVURV9TRUxFQ1RJT05fUk9XOiBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyICR0YWJsZSA9IF9hLiR0YWJsZTtcbiAgICAgICAgJHRhYmxlLnJlbW92ZVNlbGVjdGVkcygpO1xuICAgIH0sXG4gICAgREVMRVRFX0FMTDogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBfYS4kdGFibGU7XG4gICAgICAgICR0YWJsZS5yZW1vdmUoKTtcbiAgICB9LFxuICAgIENMRUFSX1NPUlQ6IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICB2YXIgJHRhYmxlID0gX2EuJHRhYmxlO1xuICAgICAgICAkdGFibGUuY2xlYXJTb3J0KCk7XG4gICAgfSxcbiAgICBTT1JUX0FTQzogZnVuY3Rpb24gKF9hLCBldm50KSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBfYS4kdGFibGUsIGNvbHVtbiA9IF9hLmNvbHVtbjtcbiAgICAgICAgaWYgKGNvbHVtbikge1xuICAgICAgICAgICAgJHRhYmxlLnRyaWdnZXJTb3J0RXZlbnQoZXZudCwgY29sdW1uLCAnYXNjJyk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIFNPUlRfREVTQzogZnVuY3Rpb24gKF9hLCBldm50KSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBfYS4kdGFibGUsIGNvbHVtbiA9IF9hLmNvbHVtbjtcbiAgICAgICAgaWYgKGNvbHVtbikge1xuICAgICAgICAgICAgJHRhYmxlLnRyaWdnZXJTb3J0RXZlbnQoZXZudCwgY29sdW1uLCAnZGVzYycpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBDTEVBUl9GSUxURVI6IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICB2YXIgJHRhYmxlID0gX2EuJHRhYmxlLCBjb2x1bW4gPSBfYS5jb2x1bW47XG4gICAgICAgIGlmIChjb2x1bW4pIHtcbiAgICAgICAgICAgICR0YWJsZS5jbGVhckZpbHRlcihjb2x1bW4ucHJvcGVydHkpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBDTEVBUl9BTExfRklMVEVSOiBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyICR0YWJsZSA9IF9hLiR0YWJsZTtcbiAgICAgICAgJHRhYmxlLmNsZWFyRmlsdGVyKCk7XG4gICAgfSxcbiAgICBGSUxURVJfQ0VMTDogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBfYS4kdGFibGUsIHJvdyA9IF9hLnJvdywgY29sdW1uID0gX2EuY29sdW1uO1xuICAgICAgICBpZiAocm93ICYmIGNvbHVtbikge1xuICAgICAgICAgICAgdmFyIHByb3BlcnR5XzEgPSBjb2x1bW4ucHJvcGVydHk7XG4gICAgICAgICAgICAkdGFibGUuZmlsdGVyKHByb3BlcnR5XzEpXG4gICAgICAgICAgICAgICAgLnRoZW4oZnVuY3Rpb24gKG9wdGlvbnMpIHtcbiAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIG9wdGlvbiA9IG9wdGlvbnNbMF07XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbi5kYXRhID0geGVfdXRpbHNfMVtcImRlZmF1bHRcIl0uZ2V0KHJvdywgcHJvcGVydHlfMSk7XG4gICAgICAgICAgICAgICAgICAgIG9wdGlvbi5jaGVja2VkID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgICAgIC50aGVuKGZ1bmN0aW9uICgpIHsgcmV0dXJuICR0YWJsZS51cGRhdGVEYXRhKCk7IH0pO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBFWFBPUlRfUk9XOiBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyICR0YWJsZSA9IF9hLiR0YWJsZSwgbWVudSA9IF9hLm1lbnUsIHJvdyA9IF9hLnJvdztcbiAgICAgICAgaWYgKHJvdykge1xuICAgICAgICAgICAgdmFyIG9wdHMgPSB7IGRhdGE6IFtyb3ddIH07XG4gICAgICAgICAgICAkdGFibGUuZXhwb3J0Q3N2KG1lbnUucGFyYW1zID8geGVfdXRpbHNfMVtcImRlZmF1bHRcIl0uYXNzaWduKG9wdHMsIG1lbnUucGFyYW1zWzBdKSA6IG9wdHMpO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBFWFBPUlRfU0VMRUNUSU9OX1JPVzogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBfYS4kdGFibGUsIG1lbnUgPSBfYS5tZW51O1xuICAgICAgICB2YXIgb3B0cyA9IHsgZGF0YTogJHRhYmxlLmdldFNlbGVjdFJlY29yZHMoKSB9O1xuICAgICAgICAkdGFibGUuZXhwb3J0Q3N2KG1lbnUucGFyYW1zID8geGVfdXRpbHNfMVtcImRlZmF1bHRcIl0uYXNzaWduKG9wdHMsIG1lbnUucGFyYW1zWzBdKSA6IG9wdHMpO1xuICAgIH0sXG4gICAgRVhQT1JUX0FMTDogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBfYS4kdGFibGU7XG4gICAgICAgICR0YWJsZS5leHBvcnRDc3YoKTtcbiAgICB9LFxuICAgIEhJRERFTl9DT0xVTU46IGZ1bmN0aW9uIChfYSkge1xuICAgICAgICB2YXIgJHRhYmxlID0gX2EuJHRhYmxlLCBjb2x1bW4gPSBfYS5jb2x1bW47XG4gICAgICAgIGlmIChjb2x1bW4pIHtcbiAgICAgICAgICAgICR0YWJsZS5oaWRlQ29sdW1uKCk7XG4gICAgICAgIH1cbiAgICB9LFxuICAgIFJFU0VUX0NPTFVNTjogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBfYS4kdGFibGU7XG4gICAgICAgICR0YWJsZS5yZXNldEN1c3RvbXMoKTtcbiAgICB9LFxuICAgIFJFU0VUX1JFU0laQUJMRTogZnVuY3Rpb24gKF9hKSB7XG4gICAgICAgIHZhciAkdGFibGUgPSBfYS4kdGFibGU7XG4gICAgICAgICR0YWJsZS5yZXNldFJlc2l6YWJsZSgpO1xuICAgIH0sXG4gICAgUkVTRVRfQUxMOiBmdW5jdGlvbiAoX2EpIHtcbiAgICAgICAgdmFyICR0YWJsZSA9IF9hLiR0YWJsZTtcbiAgICAgICAgJHRhYmxlLnJlc2V0QWxsKCk7XG4gICAgfVxufTtcbmZ1bmN0aW9uIGNoZWNrUHJpdmlsZWdlKGl0ZW0sIHBhcmFtcykge1xuICAgIHZhciBjb2RlID0gaXRlbS5jb2RlO1xuICAgIHZhciBjb2x1bW5zID0gcGFyYW1zLmNvbHVtbnMsIGNvbHVtbiA9IHBhcmFtcy5jb2x1bW47XG4gICAgc3dpdGNoIChjb2RlKSB7XG4gICAgICAgIGNhc2UgJ0NMRUFSX1NPUlQnOlxuICAgICAgICAgICAgaXRlbS5kaXNhYmxlZCA9ICFjb2x1bW5zLnNvbWUoZnVuY3Rpb24gKGNvbHVtbikgeyByZXR1cm4gY29sdW1uLnNvcnRhYmxlICYmIGNvbHVtbi5vcmRlcjsgfSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnQ0xFQVJfQUxMX0ZJTFRFUic6XG4gICAgICAgICAgICBpdGVtLmRpc2FibGVkID0gIWNvbHVtbnMuc29tZShmdW5jdGlvbiAoY29sdW1uKSB7IHJldHVybiBjb2x1bW4uZmlsdGVycyAmJiBjb2x1bW4uZmlsdGVycy5zb21lKGZ1bmN0aW9uIChvcHRpb24pIHsgcmV0dXJuIG9wdGlvbi5jaGVja2VkOyB9KTsgfSk7XG4gICAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnQ0xFQVJfQ0VMTCc6XG4gICAgICAgIGNhc2UgJ0NMRUFSX1JPVyc6XG4gICAgICAgIGNhc2UgJ1JFVkVSVF9DRUxMJzpcbiAgICAgICAgY2FzZSAnUkVWRVJUX1JPVyc6XG4gICAgICAgIGNhc2UgJ0lOU0VSVF9BVF9ST1cnOlxuICAgICAgICBjYXNlICdJTlNFUlRfQVRfQUNUSVZFRF9ST1cnOlxuICAgICAgICBjYXNlICdERUxFVEVfUk9XJzpcbiAgICAgICAgY2FzZSAnU09SVF9BU0MnOlxuICAgICAgICBjYXNlICdTT1JUX0RFU0MnOlxuICAgICAgICBjYXNlICdDTEVBUl9GSUxURVInOlxuICAgICAgICBjYXNlICdGSUxURVJfQ0VMTCc6XG4gICAgICAgIGNhc2UgJ0VYUE9SVF9ST1cnOlxuICAgICAgICBjYXNlICdISURERU5fQ09MVU1OJzpcbiAgICAgICAgICAgIGl0ZW0uZGlzYWJsZWQgPSAhY29sdW1uO1xuICAgICAgICAgICAgaWYgKCFpdGVtLmRpc2FibGVkKSB7XG4gICAgICAgICAgICAgICAgc3dpdGNoIChjb2RlKSB7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ1NPUlRfQVNDJzpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnU09SVF9ERVNDJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGlzYWJsZWQgPSAhY29sdW1uLnNvcnRhYmxlO1xuICAgICAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgICAgIGNhc2UgJ0ZJTFRFUl9DRUxMJzpcbiAgICAgICAgICAgICAgICAgICAgY2FzZSAnQ0xFQVJfRklMVEVSJzpcbiAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW0uZGlzYWJsZWQgPSAhY29sdW1uLmZpbHRlcnMgfHwgIWNvbHVtbi5maWx0ZXJzLmxlbmd0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICghaXRlbS5kaXNhYmxlZCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN3aXRjaCAoY29kZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjYXNlICdDTEVBUl9GSUxURVInOlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaXRlbS5kaXNhYmxlZCA9ICFjb2x1bW4uZmlsdGVycy5zb21lKGZ1bmN0aW9uIChvcHRpb24pIHsgcmV0dXJuIG9wdGlvbi5jaGVja2VkOyB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGJyZWFrO1xuICAgIH1cbn1cbmZ1bmN0aW9uIGhhbmRsZVByaXZpbGVnZUV2ZW50KHBhcmFtcykge1xuICAgIHBhcmFtcy5vcHRpb25zLmZvckVhY2goZnVuY3Rpb24gKGxpc3QpIHtcbiAgICAgICAgbGlzdC5mb3JFYWNoKGZ1bmN0aW9uIChpdGVtKSB7XG4gICAgICAgICAgICBjaGVja1ByaXZpbGVnZShpdGVtLCBwYXJhbXMpO1xuICAgICAgICAgICAgaWYgKGl0ZW0uY2hpbGRyZW4pIHtcbiAgICAgICAgICAgICAgICBpdGVtLmNoaWxkcmVuLmZvckVhY2goZnVuY3Rpb24gKGNoaWxkKSB7XG4gICAgICAgICAgICAgICAgICAgIGNoZWNrUHJpdmlsZWdlKGNoaWxkLCBwYXJhbXMpO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbi8qKlxuICog5Z+65LqOIHZ4ZS10YWJsZSDooajmoLznmoTlop7lvLrmj5Lku7bvvIzmj5Dkvpvlrp7nlKjnmoTlv6vmjbfoj5zljZXpm4ZcbiAqL1xuZXhwb3J0cy5WWEVUYWJsZVBsdWdpbk1lbnVzID0ge1xuICAgIGluc3RhbGw6IGZ1bmN0aW9uICh4dGFibGUpIHtcbiAgICAgICAgeHRhYmxlLmludGVyY2VwdG9yLmFkZCgnZXZlbnQuc2hvd19tZW51JywgaGFuZGxlUHJpdmlsZWdlRXZlbnQpO1xuICAgICAgICB4dGFibGUubWVudXMubWl4aW4obWVudU1hcCk7XG4gICAgfVxufTtcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuVlhFVGFibGUpIHtcbiAgICB3aW5kb3cuVlhFVGFibGUudXNlKGV4cG9ydHMuVlhFVGFibGVQbHVnaW5NZW51cyk7XG59XG5leHBvcnRzW1wiZGVmYXVsdFwiXSA9IGV4cG9ydHMuVlhFVGFibGVQbHVnaW5NZW51cztcbiIsImltcG9ydCBYRVV0aWxzIGZyb20gJ3hlLXV0aWxzL21ldGhvZHMveGUtdXRpbHMnXHJcbmltcG9ydCB7IFZYRVRhYmxlIH0gZnJvbSAndnhlLXRhYmxlJ1xyXG5cclxuY29uc3QgbWVudU1hcCA9IHtcclxuICBDTEVBUl9DRUxMICh7ICR0YWJsZSwgcm93LCBjb2x1bW4gfTogYW55KSB7XHJcbiAgICBpZiAocm93ICYmIGNvbHVtbikge1xyXG4gICAgICAkdGFibGUuY2xlYXJEYXRhKHJvdywgY29sdW1uLnByb3BlcnR5KVxyXG4gICAgfVxyXG4gIH0sXHJcbiAgQ0xFQVJfUk9XICh7ICR0YWJsZSwgcm93IH06IGFueSkge1xyXG4gICAgaWYgKHJvdykge1xyXG4gICAgICAkdGFibGUuY2xlYXJEYXRhKHJvdylcclxuICAgIH1cclxuICB9LFxyXG4gIENMRUFSX1NFTEVDVElPTl9ST1cgKHsgJHRhYmxlIH06IGFueSkge1xyXG4gICAgJHRhYmxlLmNsZWFyRGF0YSgkdGFibGUuZ2V0U2VsZWN0UmVjb3JkcygpKVxyXG4gIH0sXHJcbiAgQ0xFQVJfQUxMICh7ICR0YWJsZSB9OiBhbnkpIHtcclxuICAgICR0YWJsZS5jbGVhckRhdGEoKVxyXG4gIH0sXHJcbiAgUkVWRVJUX0NFTEwgKHsgJHRhYmxlLCByb3csIGNvbHVtbiB9OiBhbnkpIHtcclxuICAgIGlmIChyb3cgJiYgY29sdW1uKSB7XHJcbiAgICAgICR0YWJsZS5yZXZlcnREYXRhKHJvdywgY29sdW1uLnByb3BlcnR5KVxyXG4gICAgfVxyXG4gIH0sXHJcbiAgUkVWRVJUX1JPVyAoeyAkdGFibGUsIHJvdyB9OiBhbnkpIHtcclxuICAgIGlmIChyb3cpIHtcclxuICAgICAgJHRhYmxlLnJldmVydERhdGEocm93KVxyXG4gICAgfVxyXG4gIH0sXHJcbiAgUkVWRVJUX1NFTEVDVElPTl9ST1cgKHsgJHRhYmxlIH06IGFueSkge1xyXG4gICAgJHRhYmxlLnJldmVydERhdGEoJHRhYmxlLmdldFNlbGVjdFJlY29yZHMoKSlcclxuICB9LFxyXG4gIFJFVkVSVF9BTEwgKHsgJHRhYmxlIH06IGFueSkge1xyXG4gICAgJHRhYmxlLnJldmVydERhdGEoKVxyXG4gIH0sXHJcbiAgSU5TRVJUX1JPVyAoeyAkdGFibGUsIG1lbnUgfTogYW55KSB7XHJcbiAgICAkdGFibGUuaW5zZXJ0KG1lbnUucGFyYW1zKVxyXG4gIH0sXHJcbiAgSU5TRVJUX0FDVElWRURfUk9XICh7ICR0YWJsZSwgbWVudSwgY29sdW1uIH06IGFueSkge1xyXG4gICAgY29uc3QgYXJncyA9IG1lbnUucGFyYW1zIHx8IFtdXHJcbiAgICAkdGFibGUuaW5zZXJ0KGFyZ3NbMF0pXHJcbiAgICAgIC50aGVuKCh7IHJvdyB9OiBhbnkpID0+ICR0YWJsZS5zZXRBY3RpdmVDZWxsKHJvdywgYXJnc1sxXSB8fCBjb2x1bW4ucHJvcGVydHkpKVxyXG4gIH0sXHJcbiAgSU5TRVJUX0FUX1JPVyAoeyAkdGFibGUsIG1lbnUsIHJvdyB9OiBhbnkpIHtcclxuICAgIGlmIChyb3cpIHtcclxuICAgICAgJHRhYmxlLmluc2VydEF0KG1lbnUucGFyYW1zLCByb3cpXHJcbiAgICB9XHJcbiAgfSxcclxuICBJTlNFUlRfQVRfQUNUSVZFRF9ST1cgKHsgJHRhYmxlLCBtZW51LCByb3csIGNvbHVtbiB9OiBhbnkpIHtcclxuICAgIGlmIChyb3cpIHtcclxuICAgICAgY29uc3QgYXJncyA9IG1lbnUucGFyYW1zIHx8IFtdXHJcbiAgICAgICR0YWJsZS5pbnNlcnRBdChhcmdzWzBdLCByb3cpXHJcbiAgICAgICAgLnRoZW4oKHsgcm93IH06IGFueSkgPT4gJHRhYmxlLnNldEFjdGl2ZUNlbGwocm93LCBhcmdzWzFdIHx8IGNvbHVtbi5wcm9wZXJ0eSkpXHJcbiAgICB9XHJcbiAgfSxcclxuICBERUxFVEVfUk9XICh7ICR0YWJsZSwgcm93IH06IGFueSkge1xyXG4gICAgaWYgKHJvdykge1xyXG4gICAgICAkdGFibGUucmVtb3ZlKHJvdylcclxuICAgIH1cclxuICB9LFxyXG4gIERFTEVURV9TRUxFQ1RJT05fUk9XICh7ICR0YWJsZSB9OiBhbnkpIHtcclxuICAgICR0YWJsZS5yZW1vdmVTZWxlY3RlZHMoKVxyXG4gIH0sXHJcbiAgREVMRVRFX0FMTCAoeyAkdGFibGUgfTogYW55KSB7XHJcbiAgICAkdGFibGUucmVtb3ZlKClcclxuICB9LFxyXG4gIENMRUFSX1NPUlQgKHsgJHRhYmxlIH06IGFueSkge1xyXG4gICAgJHRhYmxlLmNsZWFyU29ydCgpXHJcbiAgfSxcclxuICBTT1JUX0FTQyAoeyAkdGFibGUsIGNvbHVtbiB9OiBhbnksIGV2bnQ6IGFueSkge1xyXG4gICAgaWYgKGNvbHVtbikge1xyXG4gICAgICAkdGFibGUudHJpZ2dlclNvcnRFdmVudChldm50LCBjb2x1bW4sICdhc2MnKVxyXG4gICAgfVxyXG4gIH0sXHJcbiAgU09SVF9ERVNDICh7ICR0YWJsZSwgY29sdW1uIH06IGFueSwgZXZudDogYW55KSB7XHJcbiAgICBpZiAoY29sdW1uKSB7XHJcbiAgICAgICR0YWJsZS50cmlnZ2VyU29ydEV2ZW50KGV2bnQsIGNvbHVtbiwgJ2Rlc2MnKVxyXG4gICAgfVxyXG4gIH0sXHJcbiAgQ0xFQVJfRklMVEVSICh7ICR0YWJsZSwgY29sdW1uIH06IGFueSkge1xyXG4gICAgaWYgKGNvbHVtbikge1xyXG4gICAgICAkdGFibGUuY2xlYXJGaWx0ZXIoY29sdW1uLnByb3BlcnR5KVxyXG4gICAgfVxyXG4gIH0sXHJcbiAgQ0xFQVJfQUxMX0ZJTFRFUiAoeyAkdGFibGUgfTogYW55KSB7XHJcbiAgICAkdGFibGUuY2xlYXJGaWx0ZXIoKVxyXG4gIH0sXHJcbiAgRklMVEVSX0NFTEwgKHsgJHRhYmxlLCByb3csIGNvbHVtbiB9OiBhbnkpIHtcclxuICAgIGlmIChyb3cgJiYgY29sdW1uKSB7XHJcbiAgICAgIGxldCB7IHByb3BlcnR5IH0gPSBjb2x1bW5cclxuICAgICAgJHRhYmxlLmZpbHRlcihwcm9wZXJ0eSlcclxuICAgICAgICAudGhlbigob3B0aW9uczogQXJyYXk8YW55PikgPT4ge1xyXG4gICAgICAgICAgaWYgKG9wdGlvbnMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxldCBvcHRpb24gPSBvcHRpb25zWzBdXHJcbiAgICAgICAgICAgIG9wdGlvbi5kYXRhID0gWEVVdGlscy5nZXQocm93LCBwcm9wZXJ0eSlcclxuICAgICAgICAgICAgb3B0aW9uLmNoZWNrZWQgPSB0cnVlXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgICAgICAudGhlbigoKSA9PiAkdGFibGUudXBkYXRlRGF0YSgpKVxyXG4gICAgfVxyXG4gIH0sXHJcbiAgRVhQT1JUX1JPVyAoeyAkdGFibGUsIG1lbnUsIHJvdyB9OiBhbnkpIHtcclxuICAgIGlmIChyb3cpIHtcclxuICAgICAgbGV0IG9wdHMgPSB7IGRhdGE6IFtyb3ddIH1cclxuICAgICAgJHRhYmxlLmV4cG9ydENzdihtZW51LnBhcmFtcyA/IFhFVXRpbHMuYXNzaWduKG9wdHMsIG1lbnUucGFyYW1zWzBdKSA6IG9wdHMpXHJcbiAgICB9XHJcbiAgfSxcclxuICBFWFBPUlRfU0VMRUNUSU9OX1JPVyAoeyAkdGFibGUsIG1lbnUgfTogYW55KSB7XHJcbiAgICBsZXQgb3B0cyA9IHsgZGF0YTogJHRhYmxlLmdldFNlbGVjdFJlY29yZHMoKSB9XHJcbiAgICAkdGFibGUuZXhwb3J0Q3N2KG1lbnUucGFyYW1zID8gWEVVdGlscy5hc3NpZ24ob3B0cywgbWVudS5wYXJhbXNbMF0pIDogb3B0cylcclxuICB9LFxyXG4gIEVYUE9SVF9BTEwgKHsgJHRhYmxlIH06IGFueSkge1xyXG4gICAgJHRhYmxlLmV4cG9ydENzdigpXHJcbiAgfSxcclxuICBISURERU5fQ09MVU1OICh7ICR0YWJsZSwgY29sdW1uIH06IGFueSkge1xyXG4gICAgaWYgKGNvbHVtbikge1xyXG4gICAgICAkdGFibGUuaGlkZUNvbHVtbigpXHJcbiAgICB9XHJcbiAgfSxcclxuICBSRVNFVF9DT0xVTU4gKHsgJHRhYmxlIH06IGFueSkge1xyXG4gICAgJHRhYmxlLnJlc2V0Q3VzdG9tcygpXHJcbiAgfSxcclxuICBSRVNFVF9SRVNJWkFCTEUgKHsgJHRhYmxlIH06IGFueSkge1xyXG4gICAgJHRhYmxlLnJlc2V0UmVzaXphYmxlKClcclxuICB9LFxyXG4gIFJFU0VUX0FMTCAoeyAkdGFibGUgfTogYW55KSB7XHJcbiAgICAkdGFibGUucmVzZXRBbGwoKVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gY2hlY2tQcml2aWxlZ2UgKGl0ZW06IGFueSwgcGFyYW1zOiBhbnkpIHtcclxuICBsZXQgeyBjb2RlIH0gPSBpdGVtXHJcbiAgbGV0IHsgY29sdW1ucywgY29sdW1uIH0gPSBwYXJhbXNcclxuICBzd2l0Y2ggKGNvZGUpIHtcclxuICAgIGNhc2UgJ0NMRUFSX1NPUlQnOlxyXG4gICAgICBpdGVtLmRpc2FibGVkID0gIWNvbHVtbnMuc29tZSgoY29sdW1uOiBhbnkpID0+IGNvbHVtbi5zb3J0YWJsZSAmJiBjb2x1bW4ub3JkZXIpXHJcbiAgICAgIGJyZWFrXHJcbiAgICBjYXNlICdDTEVBUl9BTExfRklMVEVSJzpcclxuICAgICAgaXRlbS5kaXNhYmxlZCA9ICFjb2x1bW5zLnNvbWUoKGNvbHVtbjogYW55KSA9PiBjb2x1bW4uZmlsdGVycyAmJiBjb2x1bW4uZmlsdGVycy5zb21lKChvcHRpb246IGFueSkgPT4gb3B0aW9uLmNoZWNrZWQpKVxyXG4gICAgICBicmVha1xyXG4gICAgY2FzZSAnQ0xFQVJfQ0VMTCc6XHJcbiAgICBjYXNlICdDTEVBUl9ST1cnOlxyXG4gICAgY2FzZSAnUkVWRVJUX0NFTEwnOlxyXG4gICAgY2FzZSAnUkVWRVJUX1JPVyc6XHJcbiAgICBjYXNlICdJTlNFUlRfQVRfUk9XJzpcclxuICAgIGNhc2UgJ0lOU0VSVF9BVF9BQ1RJVkVEX1JPVyc6XHJcbiAgICBjYXNlICdERUxFVEVfUk9XJzpcclxuICAgIGNhc2UgJ1NPUlRfQVNDJzpcclxuICAgIGNhc2UgJ1NPUlRfREVTQyc6XHJcbiAgICBjYXNlICdDTEVBUl9GSUxURVInOlxyXG4gICAgY2FzZSAnRklMVEVSX0NFTEwnOlxyXG4gICAgY2FzZSAnRVhQT1JUX1JPVyc6XHJcbiAgICBjYXNlICdISURERU5fQ09MVU1OJzpcclxuICAgICAgaXRlbS5kaXNhYmxlZCA9ICFjb2x1bW5cclxuICAgICAgaWYgKCFpdGVtLmRpc2FibGVkKSB7XHJcbiAgICAgICAgc3dpdGNoIChjb2RlKSB7XHJcbiAgICAgICAgICBjYXNlICdTT1JUX0FTQyc6XHJcbiAgICAgICAgICBjYXNlICdTT1JUX0RFU0MnOlxyXG4gICAgICAgICAgICBpdGVtLmRpc2FibGVkID0gIWNvbHVtbi5zb3J0YWJsZVxyXG4gICAgICAgICAgICBicmVha1xyXG4gICAgICAgICAgY2FzZSAnRklMVEVSX0NFTEwnOlxyXG4gICAgICAgICAgY2FzZSAnQ0xFQVJfRklMVEVSJzpcclxuICAgICAgICAgICAgaXRlbS5kaXNhYmxlZCA9ICFjb2x1bW4uZmlsdGVycyB8fCAhY29sdW1uLmZpbHRlcnMubGVuZ3RoXHJcbiAgICAgICAgICAgIGlmICghaXRlbS5kaXNhYmxlZCkge1xyXG4gICAgICAgICAgICAgIHN3aXRjaCAoY29kZSkge1xyXG4gICAgICAgICAgICAgICAgY2FzZSAnQ0xFQVJfRklMVEVSJzpcclxuICAgICAgICAgICAgICAgICAgaXRlbS5kaXNhYmxlZCA9ICFjb2x1bW4uZmlsdGVycy5zb21lKChvcHRpb246IGFueSkgPT4gb3B0aW9uLmNoZWNrZWQpXHJcbiAgICAgICAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGJyZWFrXHJcbiAgICAgICAgfVxyXG4gICAgICB9XHJcbiAgICAgIGJyZWFrXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVQcml2aWxlZ2VFdmVudCAocGFyYW1zOiBhbnkpIHtcclxuICBwYXJhbXMub3B0aW9ucy5mb3JFYWNoKChsaXN0OiBBcnJheTxhbnk+KSA9PiB7XHJcbiAgICBsaXN0LmZvckVhY2goKGl0ZW06IGFueSkgPT4ge1xyXG4gICAgICBjaGVja1ByaXZpbGVnZShpdGVtLCBwYXJhbXMpXHJcbiAgICAgIGlmIChpdGVtLmNoaWxkcmVuKSB7XHJcbiAgICAgICAgaXRlbS5jaGlsZHJlbi5mb3JFYWNoKChjaGlsZDogYW55KSA9PiB7XHJcbiAgICAgICAgICBjaGVja1ByaXZpbGVnZShjaGlsZCwgcGFyYW1zKVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH1cclxuICAgIH0pXHJcbiAgfSlcclxufVxyXG5cclxuLyoqXHJcbiAqIOWfuuS6jiB2eGUtdGFibGUg6KGo5qC855qE5aKe5by65o+S5Lu277yM5o+Q5L6b5a6e55So55qE5b+r5o236I+c5Y2V6ZuGXHJcbiAqL1xyXG5leHBvcnQgY29uc3QgVlhFVGFibGVQbHVnaW5NZW51cyA9IHtcclxuICBpbnN0YWxsICh4dGFibGU6IHR5cGVvZiBWWEVUYWJsZSkge1xyXG4gICAgeHRhYmxlLmludGVyY2VwdG9yLmFkZCgnZXZlbnQuc2hvd19tZW51JywgaGFuZGxlUHJpdmlsZWdlRXZlbnQpXHJcbiAgICB4dGFibGUubWVudXMubWl4aW4obWVudU1hcClcclxuICB9XHJcbn1cclxuXHJcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuVlhFVGFibGUpIHtcclxuICB3aW5kb3cuVlhFVGFibGUudXNlKFZYRVRhYmxlUGx1Z2luTWVudXMpXHJcbn1cclxuXHJcbmV4cG9ydCBkZWZhdWx0IFZYRVRhYmxlUGx1Z2luTWVudXNcclxuIl19
